<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anti-Malarial Demand Forecasting Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Condensed:wght@400;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.umd.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link href="/static/css/styles.css" rel="stylesheet">
</head>
<body>
    <header class="dashboard-header">
        <div class="logo">
            <i class="fas fa-virus"></i> <span class="logo-text">Anti-Malarial Demand Forecast</span>
        </div>
        <div class="nav-links">
            <button class="btn btn-sm btn-outline-secondary theme-toggle" id="themeToggle" title="Toggle Dark Mode">
                <i class="fas fa-moon"></i>
            </button>
            <a href="#" class="btn btn-sm btn-outline-primary" id="refreshData"><i class="fas fa-sync-alt"></i> Refresh</a>
            <a href="#" class="btn btn-sm btn-outline-info"><i class="fas fa-database"></i> Data Sources</a>
            <a href="#" class="btn btn-sm btn-outline-info"><i class="fas fa-info-circle"></i> About</a>
        </div>
    </header>

    <main class="dashboard-main">
        <div class="dashboard-title-container">
            <h1 class="dashboard-title">Anti-Malarial Demand Forecasting Dashboard</h1>
            <p class="dashboard-subtitle">Real-time insights for three-month ahead anti-malarial demand and malaria case predictions</p>
        </div>

        <div class="loading-spinner" id="loadingSpinner">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p>Loading dashboard data...</p>
        </div>

        <div class="alert alert-danger alert-dismissible fade show" role="alert" id="alert" style="display:none;">
            <span id="alert-message"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-header">
                    <i class="fas fa-prescription-bottle-alt"></i>
                    <h4>Current DDD Demand</h4>
                </div>
                <div class="metric-value" id="currentDemand">-</div>
                <div class="metric-trend up" id="demandTrend">-</div>
            </div>
            <div class="metric-card">
                <div class="metric-header">
                    <i class="fas fa-thermometer-half"></i>
                    <h4>Avg Temperature</h4>
                </div>
                <div class="metric-value" id="avgTemp">-</div>
                <div class="metric-trend up" id="tempTrend">-</div>
            </div>
            <div class="metric-card">
                <div class="metric-header">
                    <i class="fas fa-cloud-rain"></i>
                    <h4>Precipitation</h4>
                </div>
                <div class="metric-value" id="precipTotal">-</div>
                <div class="metric-trend down" id="precipTrend">-</div>
            </div>
            <div class="metric-card">
                <div class="metric-header">
                    <i class="fas fa-tint"></i>
                    <h4>Humidity</h4>
                </div>
                <div class="metric-value" id="humidityAvg">-</div>
                <div class="metric-trend up" id="humidityTrend">-</div>
            </div>
        </div>

        <ul class="nav nav-tabs dashboard-tabs" id="dashboardTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview-tab-pane" type="button" role="tab">
                    <i class="fas fa-chart-line"></i> Demand Overview
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="input-tab" data-bs-toggle="tab" data-bs-target="#input-tab-pane" type="button" role="tab">
                    <i class="fas fa-database"></i> Input Data
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="predictions-tab" data-bs-toggle="tab" data-bs-target="#predictions-tab-pane" type="button" role="tab">
                    <i class="fas fa-chart-bar"></i> Demand Forecasts
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="comparison-tab" data-bs-toggle="tab" data-bs-target="#comparison-tab-pane" type="button" role="tab">
                    <i class="fas fa-balance-scale"></i> Model Comparison
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="malaria-overview-tab" data-bs-toggle="tab" data-bs-target="#malaria-overview-tab-pane" type="button" role="tab">
                    <i class="fas fa-bug"></i> Malaria Overview
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="advanced-map-tab" data-bs-toggle="tab" data-bs-target="#advanced-map-tab-pane" type="button" role="tab">
                    <i class="fas fa-map-marked-alt"></i> Advanced Map
                </button>
            </li>
        </ul>

        <div class="tab-content" id="dashboardTabContent">
            <!-- Overview Tab -->
            <div class="tab-pane fade show active" id="overview-tab-pane" role="tabpanel">
                <div class="dashboard-grid">
                    <div class="dashboard-card wide-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-area"></i> DDD Demand Forecast Overview</h3>
                            <div class="chart-controls">
                                <button class="chart-btn active" data-range="3">3M</button>
                                <button class="chart-btn" data-range="6">6M</button>
                                <button class="chart-btn" data-range="12">12M</button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="overviewChart"></canvas>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <h3><i class="fas fa-exclamation-triangle"></i> Risk Indicators</h3>
                        <div class="chart-container">
                            <canvas id="riskChart"></canvas>
                        </div>
                        <div class="mt-3">
                            <p><span class="highlight">Precipitation Risk:</span> <span id="precipRisk">-</span></p>
                            <p><span class="warning-highlight">Temperature Risk:</span> <span id="tempRisk">-</span></p>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <h3><i class="fas fa-lightbulb"></i> Key Insights</h3>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">DDD demand expected to peak in <span class="highlight" id="peakDemandMonth">-</span></li>
                            <li class="list-group-item">High precipitation correlates with <span class="highlight">increased DDD demand</span></li>
                            <li class="list-group-item">Best performing model: <span class="highlight" id="bestModelOverview">-</span></li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Input Data Tab -->
            <div class="tab-pane fade" id="input-tab-pane" role="tabpanel">
                <div class="dashboard-grid">
                    <div class="dashboard-card wide-card">
                        <h3><i class="fas fa-database"></i> Input Dataset</h3>
                        <p>Last 12 months of data (Apr 2024 - Mar 2025)</p>
                        <div class="table-responsive">
                            <table class="table table-striped table-hover" id="inputDataTable">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Max Temp (°C)</th>
                                        <th>Min Temp (°C)</th>
                                        <th>Humidity (%)</th>
                                        <th>Precip (mm)</th>
                                        <th>Sunshine (hrs)</th>
                                        <th>DDD Demand</th>
                                    </tr>
                                </thead>
                                <tbody id="inputDataBody"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <h3><i class="fas fa-chart-line"></i> Environmental Trends</h3>
                        <div class="chart-container">
                            <canvas id="environmentChart"></canvas>
                        </div>
                        <div class="mt-3">
                            <p><span class="highlight">Correlation with DDD Demand:</span> <span id="demandCorrelation">-</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Predictions Tab -->
            <div class="tab-pane fade" id="predictions-tab-pane" role="tabpanel">
                <div class="dashboard-grid">
                    <div class="dashboard-card wide-card">
                        <h3><i class="fas fa-star"></i> Best Model: <span id="bestModelName">-</span></h3>
                        <p>Three-month ahead anti-malarial DDD demand forecasts</p>
                        <div class="chart-container">
                            <canvas id="forecastChart"></canvas>
                        </div>
                    </div>
                    <div class="dashboard-card highlight-card">
                        <h3><i class="fas fa-calendar-alt"></i> Forecast Values</h3>
                        <div class="forecast-values">
                            <div class="forecast-item">
                                <h4>Apr 2025</h4>
                                <span class="highlight" id="aprForecast">-</span>
                            </div>
                            <div class="forecast-item">
                                <h4>May 2025</h4>
                                <span class="highlight" id="mayForecast">-</span>
                            </div>
                            <div class="forecast-item">
                                <h4>Jun 2025</h4>
                                <span class="highlight" id="junForecast">-</span>
                            </div>
                        </div>
                        <div class="forecast-total">
                            <p><span class="highlight">Total Forecasted DDD Demand:</span> <span id="totalForecast">-</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Comparison Tab -->
            <div class="tab-pane fade" id="comparison-tab-pane" role="tabpanel">
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <h3><i class="fas fa-balance-scale"></i> Model Performance</h3>
                        <div class="chart-container">
                            <canvas id="maeChart"></canvas>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <h3><i class="fas fa-chart-bar"></i> Prediction Comparison</h3>
                        <div class="chart-container">
                            <canvas id="predictionChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="dashboard-card wide-card">
                    <h3><i class="fas fa-table"></i> Model Metrics</h3>
                    <div class="table-responsive">
                        <table class="table table-striped table-hover" id="comparisonTable">
                            <thead id="comparisonTableHead"></thead>
                            <tbody id="comparisonTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Malaria Overview Tab -->
            <div class="tab-pane fade" id="malaria-overview-tab-pane" role="tabpanel">
                <div class="dashboard-grid">
                    <div class="dashboard-card wide-card">
                        <h3><i class="fas fa-bug"></i> District Status Analysis (May–July 2025)</h3>
                        <div class="table-responsive">
                            <table class="table table-striped table-hover" id="statusTable">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Status</th>
                                        <th>May 2025</th>
                                        <th>June 2025</th>
                                        <th>July 2025</th>
                                    </tr>
                                </thead>
                                <tbody id="statusTableBody">
                                    <tr><td>High</td><td>0</td><td>0</td><td>0</td></tr>
                                    <tr><td>Medium</td><td>0</td><td>0</td><td>0</td></tr>
                                    <tr><td>Low</td><td>0</td><td>0</td><td>0</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <h3><i class="fas fa-chart-bar"></i> Model Performance</h3>
                        <div class="chart-container">
                            <div id="modelPerformance"></div>
                        </div>
                        <div class="mt-3">
                            <p><span class="highlight">Best Model:</span> <span id="bestMalariaModel">-</span></p>
                            <p><span class="highlight">MAE:</span> <span id="bestMalariaMAE">-</span></p>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <h3><i class="fas fa-history"></i> Historical Trends</h3>
                        <div class="chart-container">
                            <div id="historicalTrend"></div>
                        </div>
                        <div class="mt-3">
                            <p><span class="highlight">Peak Month:</span> <span id="peakMonth">-</span></p>
                            <p><span class="highlight">Total Cases:</span> <span id="totalCases">-</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Map Tab -->
            <div class="tab-pane fade" id="advanced-map-tab-pane" role="tabpanel">
                <div class="dashboard-grid">
                    <div class="dashboard-card wide-card">
                        <div class="control-panel">
                            <h3><i class="fas fa-map-marked-alt"></i> Malaria Case Map (2025)</h3>
                            <div class="controls">
                                <div class="form-group">
                                    <label for="monthFilter">Month:</label>
                                    <select id="monthFilter" onchange="updateMap()">
                                        <option value="May_2025">May 2025</option>
                                        <option value="June_2025">June 2025</option>
                                        <option value="July_2025">July 2025</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="statusFilter">Status:</label>
                                    <select id="statusFilter" onchange="filterMarkers()">
                                        <option value="all">All</option>
                                        <option value="high">High</option>
                                        <option value="medium">Medium</option>
                                        <option value="low">Low</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="casesRange">Max Cases: <span id="sliderValue">10000</span></label>
                                    <input type="range" id="casesRange" min="0" max="10000" step="100" value="10000">
                                </div>
                            </div>
                        </div>
                        <div id="mapAndChartContainer" style="display: none;">
                            <div id="map" class="map-container"></div>
                            <div id="statsChart" class="chart-container"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="dashboard-footer">
        <p>Developed by Malaria Dashboard Team | Current Date: <span id="currentDate">-</span></p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/scripts.js"></script>
</body>
</html>